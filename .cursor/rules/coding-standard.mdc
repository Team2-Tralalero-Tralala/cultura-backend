---
description: This is a Tourism Community Management System (Cultura) backend built with Express.js and TypeScript following Three-Tier Architecture (TTA)
globs: src/**/*.ts
alwaysApply: true
---

# Cultura Tourism Community Management System - Coding Standards

## Project Context
This is a Tourism Community Management System (Cultura) backend built with Express.js and TypeScript following Three-Tier Architecture (TTA):
- **Business Logic Tier**: Express.js for RESTful API and business logic
- **Data Tier**: Prisma ORM with MySQL database for data storage and management
- **Presentation Tier**: Separate React.js frontend (not in this repository)

## File Naming Standards

### Server-side (Express.js/TypeScript)
- **Routes**: Use kebab-case with `-route.ts` suffix (e.g., `user-route.ts`, `auth-route.ts`)
- **Controllers**: Use kebab-case with `-controller.ts` suffix (e.g., `user-controller.ts`, `auth-controller.ts`)
- **Services**: Use kebab-case with `-service.ts` suffix (e.g., `user-service.ts`, `auth-service.ts`)
- **DTOs**: Use kebab-case with `-dto.ts` suffix (e.g., `user-dto.ts`, `community-dto.ts`)
- **Middlewares**: Use kebab-case with `-middleware.ts` suffix (e.g., `auth-middleware.ts`)
- **Multi-word files**: Use hyphens to separate words (e.g., `user-profile-controller.ts`)
- **File names**: Must match folder purpose (Controllers folder → `user-controller.ts`)

## Function Naming Standards

### Server-side Functions
- **Controller functions**: camelCase (e.g., `createUser`, `getUserById`)
- **Service functions**: camelCase (e.g., `validateUser`, `processPayment`)
- **Middleware functions**: camelCase (e.g., `authenticateUser`, `validateToken`)
- **Route functions**: camelCase (e.g., `getUsers`, `updateUser`)
- **DTO classes**: PascalCase (e.g., `CreateUserDto`, `UpdateCommunityDto`)

## Route Naming Standards (Server)
- Use kebab-case for paths (e.g., `/user-profiles`, `/community-events`)
- Use plural nouns in URLs (e.g., `/users`, `/activities`)
- Avoid verbs in URLs (NO: `/get-users`, YES: `/users`)
- Make names meaningful and descriptive
- Follow RESTful conventions (GET, POST, PUT, DELETE)

## Variable Naming Standards

### General Variables
- Use camelCase (e.g., `userId`, `userName`, `isActive`)

### Loop Variables
- Use descriptive names (e.g., `index`, `counter`)
- **FORBIDDEN**: Single letters like `i`, `j`, `k`

### Array Variables
- Use camelCase with plural names (e.g., `userLists`, `activityData`)

### Object Variables
- Use camelCase with descriptive nouns (e.g., `userData`, `activityInfo`)

### Boolean Variables
- Use camelCase with `is` prefix (e.g., `isReserved`, `isActive`, `isLoggedIn`)

## Database Standards

### Database Naming
- Use lowercase with underscores (e.g., `cultura_system`)

### Table Naming
- Use lowercase with underscores (e.g., `community_events`, `user_profiles`)
- Use plural nouns (e.g., `users`, `activities`, `notifications`)

### Field Naming
- Use lowercase with underscores
- Prefix with table abbreviation:
  - **Single syllable table**: First + last non-s letters (e.g., `tours` → `tr_id`)
  - **Multi-syllable table**: First syllable + last syllable (e.g., `notifications` → `nt_id`)
  - **Multi-word table**: First word + last word (e.g., `activity_reviews` → `ar_id`)
  - **Many-to-many tables**: Combine both table abbreviations (e.g., `user_activities` → `usat_id`)

### Prisma Schema Standards
- Use `@@map()` to map model names to database table names
- Use `@map()` to map field names to database column names
- **MANDATORY**: Every model must have comments explaining its purpose
- Example: `// ตาราง users คือ ตารางเก็บข้อมูลผู้ใช้ทั้งหมด`

## Config Variable Standards
- **MANDATORY**: Use UPPERCASE with snake_case (e.g., `API_KEY`, `DB_URL`)
- Use abbreviation of main topic + underscore + data name
- **FORBIDDEN**: Duplicate names, unauthorized modifications
- **REQUIRED**: Team consultation before any config changes

## Comment Standards

### Function Comments
- **MANDATORY**: Write comments before function declaration
- Include Input/Output descriptions
- Use English or Thai only
- Format:
```typescript
/*
 * คำอธิบาย : ฟังก์ชันสำหรับการดึงข้อมูลกิจกรรม
 * Input : activityId
 * Output : ข้อมูลของกิจกรรมนั้น
 */
```

### Service/Controller File Comments
- **MANDATORY**: Write service/controller description at the top of file
- Explain service/controller purpose and functionality
- Use English or Thai only
- Format:
```typescript
/*
 * คำอธิบาย : Service สำหรับจัดการข้อมูลผู้ใช้งาน เช่น การสร้าง, แก้ไข, ลบ และดึงข้อมูลผู้ใช้
 */
```

## Project Structure Standards

### Server Structure (Express.js/TypeScript)
```
src/
├── Controllers/    # Business logic controllers
├── Routes/         # Route definitions
├── Services/       # Service layer (business logic)
├── Middlewares/    # Middleware functions
├── Libs/          # Utility functions and shared code
│   ├── Types/     # TypeScript types and interfaces
│   └── ...        # Other utilities
├── prisma/        # Database schema and migrations
└── server.ts      # Main server file
```

## Code Quality Rules

### TypeScript Usage
- Define types in `/Libs/Types` folder
- Use interfaces for data structures (User, Community, ApiResponse)
- Type all function parameters and return values
- Use DTOs for request/response validation with class-validator
- Use TypedHandler for type-safe Express handlers

### Error Handling
- Implement proper error handling for all API calls
- Use try-catch blocks for async operations
- Provide meaningful error messages
- Use standard response format from `createResponse.ts`

### Performance
- Optimize database queries with proper indexing
- Use Prisma's built-in query optimization
- Implement proper pagination for large datasets
- Use connection pooling for database connections

### Security
- Validate all inputs using DTOs and class-validator
- Implement proper authentication middleware
- Use environment variables for sensitive data
- Sanitize user inputs
- Use proper CORS configuration

### Prisma Best Practices
- Use transactions for complex operations
- Implement proper error handling for database operations
- Use Prisma's type safety features
- Follow the established schema patterns
- Use proper relations and foreign keys

## Development Workflow
- Follow TTA (Three-Tier Architecture) principles
- Maintain separation of concerns
- Write tests for critical functionality
- Document all APIs and services
- Use proper Git workflow with meaningful commit messages

## Team Standards
- All team members must follow these standards
- Code reviews should verify compliance
- No exceptions to naming conventions
- All changes require team consultation for config modifications
- Use consistent code formatting (Prettier/ESLint)

## API Response Standards
- Use standard response format from `createResponse.ts`
- Include proper HTTP status codes
- Provide meaningful error messages
- Use consistent response structure across all endpoints

## DTO Validation Standards
- Use class-validator decorators for input validation
- Create separate DTOs for create, update, and query operations
- Validate all required fields
- Use proper validation messages in Thai or English
